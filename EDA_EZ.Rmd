---
title: "EDA_EZ"
author: "Eleanor Zhang"
date: "12/7/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)
library(tidyverse)
```

## objective

build a regression model that best predicts cancer mortality.

## Read data

```{r}
cancer_data <- read_csv("./data/Cancer_Registry.csv")
summary(cancer_data)
str(cancer_data)
# check strings entry
anyNA(cancer_data$binnedInc)
anyNA(cancer_data$Geography)

cancer <- cancer_data %>% 
  janitor::clean_names() %>% 
  separate(geography, into = c("county", "state"), sep = ", ") %>% # 20 variables
  select(target_death_rate, # response: Mean per capita (100000) cancer mortalities
         med_income, # median income per county
         poverty_percent, # percent of population in poverty
         median_age, # median age of county residents
         median_age_male, median_age_female, # of county residents
         county, state, 
         pct_no_hs18_24, pct_hs18_24, # age 18-24, percent of highest diploma less than/is high school 
         pct_some_col18_24, pct_bach_deg18_24, # percent of highest diploma:some colledge/bachelor
         pct_hs25_over, pct_bach_deg25_over, # >age 25, highest diploma: high school/bachelor
         pct_employed16_over, pct_unemployed16_over, # >age 16, percent of employeed / unemployeed
         pct_white, pct_black, pct_asian, pct_other_race) # percent of race
str(cancer)
```

About this data:

*   NA variables: PctSomeCol18_24(2285/), PctEmployed16_Over(152/), PctPrivateCoverageAlone(609)
*   3047 observations, 34 variables, we selected 20 variables (after separating county and state name)

## Look at the distribution

plot all variables
```{r}
cancer %>%
  keep(is.numeric) %>% 
  gather() %>% 
  ggplot(aes(value)) +
    facet_wrap(~ key, scales = "free") +
    geom_histogram()

quantile(cancer$med_income, probs = seq(0,1,0.1))
  
anyNA(cancer$med_income) # no NA

# recode income into 5 levels
cancer_new <- cancer %>% mutate(income1 = ifelse(med_income < 35000, 1,0),
                  income2 = ifelse(med_income >= 35000 & med_income < 41999, 1,0),
                  income3 = ifelse(med_income >= 42000 & med_income < 51999, 1,0),
                  income4 = ifelse(med_income >= 52000 & med_income < 58999, 1,0),
                  income5 = ifelse(med_income >= 58999, 1,0)) 
str(cancer_new)
cancer %>% 
   mutate(income_level = ifelse(med_income < 35000, "level1",
                                    ifelse(med_income >= 35000 & med_income < 41999, "level2",
                                           ifelse(med_income >= 42000 & med_income < 51999, "level3",
                                                  ifelse(med_income >= 52000 & med_income < 58999, "level4",
                                                         ifelse(med_income >= 58999, "level5",NA)))))) %>% mutate(income_level = fct_relevel(income_level, c("level1", "level2", "level3", "level4", "level5"))) %>% 
  str()
  
 
# proportion of income level (across counties)
cancer_new %>% 
  gather(key = income_level, value = value, income1:income5) %>% 
  group_by(income_level) %>% 
  summarize(mean = mean(value))
str(cancer_new) 
```

recode income level:

Level 1: < 35000
level 2: 35000 ~ 41999
level 3: 42000 ~ 51999
level 4: 52000 ~ 58999
level 5: > 58999

```{r}
all_variables <- lm(target_death_rate ~. , data = cancer_new[-c(7, 8, 9:12, 21:25)])
summary(all_variables)
HH::vif(all_variables)

```



